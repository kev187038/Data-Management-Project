############################################# Task1
with hypernyms_till_depth_three as (
select h1.hypernym, h1.type_hypernym, h1.hyponym, h1.type_hyponym
from ishypernym h1
union 
select h1.hypernym, h1.type_hypernym, h2.hyponym, h2.type_hyponym
from ishypernym h1 
      join ishypernym h2 
      on h1.hyponym = h2.hypernym and h1.type_hyponym = h2.type_hypernym
union 
select h1.hypernym, h1.type_hypernym, h3.hyponym, h3.type_hyponym
from ishypernym h1 
     join ishypernym h2 
     on h1.hyponym = h2.hypernym and h1.type_hyponym = h2.type_hypernym 
     join ishypernym h3
     on h2.hyponym = h3.hypernym and h2.type_hyponym = h3.type_hypernym 
)
select hyper.word, hyper.type, hyper.sentiment, avg(hypon.sentiment)
from words hyper join hypernyms_till_depth_three h1
     on hyper.word = h1.hypernym and hyper.type = h1.type_hypernym
     join words hypon 
     on hypon.word = h1.hyponym and hypon.type = h1.type_hyponym
where (hyper.word, hyper.type) in (select hypernym, type_hypernym
                                   from (select hypernym, type_hypernym, count((hyponym, type_hyponym)) as c
                                         from hypernyms_till_depth_three
                                         group by hypernym, type_hypernym) as counter
                                   where c > 20000)
group by hyper.word, hyper.type, hyper.sentiment;
############################################# Task2
with distant_antonyms as (
select w1.word word, w1.type type_word, w2.word antonym, w2.type type_antonym
from words w1 join isantonym a
     on w1.word = a.word and w1.type = a.type_word
     join words w2
     on w2.word = a.antonym and w2.type = a.type_antonym
where w1.sentiment - w2.sentiment > 1
), political_pairs as (
select pol1.word pol1, pol1.type type_pol1, pol1.sentiment sent_pol1,
      distant_antonyms.word ant1, distant_antonyms.type_word type_ant1,
      distant_antonyms.antonym ant2, distant_antonyms.type_antonym type_ant2,
      pol2.word pol2, pol2.type type_pol2, pol2.sentiment sent_pol2
from words pol1 join issynonym s1 on
     pol1.word = s1.word and pol1.type = s1.type_word
     join distant_antonyms 
     on s1.synonym = distant_antonyms.word and s1.type_synonym = distant_antonyms.type_word
     join issynonym s2
     on distant_antonyms.antonym = s2.synonym and distant_antonyms.type_antonym = s2.type_synonym
     join words pol2 
     on pol2.word = s2.word and pol2.type = s2.type_word
)
select pol1, type_pol1, pol2, type_pol2, ant1, type_ant1, ant2, type_ant2, abs(sent_pol1 - sent_pol2) as difference
from political_pairs as pp
where abs(sent_pol1 - sent_pol2) <= all(select abs(sent_pol1 - sent_pol2)
							from political_pairs as pp2
							where pp.ant1 = pp2.ant1 and pp.type_ant1 = pp2.type_ant1 and pp.ant2 = pp2.ant2 
									and pp.type_ant2 = pp2.type_ant2
							) and abs(sent_pol1 - sent_pol2) > 0;